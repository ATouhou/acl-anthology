{"sections":[{"title":"Location and Activity Recommendation by Using Consecutive Itinerary Matching Model","paragraphs":["劉俊賢 Jiun-Shian Liu 國立成功大學資訊工程學系","Department of Computer Science and Information Engineering National Cheng Kung University","盧文祥 Wen-Hsiang Lu 國立成功大學資訊工程學系","Department of Computer Science and Information Engineering National Cheng Kung University","whlu@ncku.edu.tw"]},{"title":"摘要","paragraphs":["許多人都有過這樣的經驗,因為事前未詳細規劃旅遊行程而導致不知道該選擇何處或何 種活動做為下一步行程。本研究提出連續行程媒合模型(CIMM),針對行動裝置使用者 當下最新的打卡資訊,找出使用者下一步的地點及活動需求。雖然我們提出的 CIMM 在初步的實驗指得到的 30%的 top-1 inclusion rate,但是我們利用打卡資訊探勘連續行 程,然後推薦給行動裝置使用者及時的下一步地點及活動需求卻是一項創新技術。"]},{"title":"Abstract","paragraphs":["In fact, most people have had the experience that they haven’t made detailed itinerary in advance before a journey, and as a result they don’t know what place or what kind of activity is suitable as the next visit location and activity after they engage in an activity in a certain place. To alleviate such problem, in this paper, we proposed the Consecutive Itinerary Matching Model to help mobile users find next locations and activities in line with their leisure needs. This model effectively utilizes time, location, user, and activity as features to find the most possible “Consecutive Itinerary” and then recommend mobile users next locations and activities. In this preliminary study, although our approach achieved only about 30% top-1 inclusion rate, however, to our knowledge, this work is novel for the recommendation of location and activity based on consecutive itinerary discovery from check-in data. 關鍵詞:地點推薦,活動推薦 Keywords: Location Recommendation, Activity Recommendation"]},{"title":"1. Introduction","paragraphs":["In fact, most people have had the experience that they haven’t made detailed itinerary in advance before a journey, and as a result they don’t know what place or what kind of activity is suitable as the next visit location and activity after they engage in an activity in a certain Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 288 place. To alleviate such problem, in this paper, we intend to propose an effective method to help mobile users find next locations and activities in line with their leisure needs. For example, after somebodies watches a film in the cinema, we can recommend them to go bowling next.","In the last few years, when people go places, the common thing for them to do is that using Facebook to check in to the places and let their friends know exactly where they are and what they’re doing. Check-in data is a new and useful resource for our work of finding next locations and activities for mobile users. In addition, many bloggers describe travel itineraries in their blog articles which are really worth discovering. Thus, to recommend effective next potential location-activity pair to mobile users, our idea is to utilize these two kinds of resources, check-in data and travel blogs. In this study, we collect and analyze a large number of travel itineraries from these two resources, and then use these data to train the Consecutive Itinerary Matching Model (CIMM). This model uses time, location, activity, and user information in check-ins and travel blogs as features to find the most possible consecutive itinerary associated to a user’s current location and activity, and then recommends him next locations and activities. The example of recommending mobile users next location and activity based on the consecutive itinerary discovery from check-ins and travel blogs is shown in Figure 1. We collected a large number of check-ins and travel blogs, and extracted a little check-in information to make useful consecutive itineraries. A consecutive itinerary includes arrival time, user gender, user age, current location, current activity, next location and next activity. Based on the extracted consecutive itineraries, we can train a CIMM to effectively recommend mobile users next locations and activities associated with their current locations and activities. To our knowledge, this method may be an innovative and useful technique. Figure 1. The example of recommending mobile users next location and activity based on the consecutive itinerary discovery from check-ins and travel blogs. Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 289"]},{"title":"2. Related Work","paragraphs":["Location recommendation always is a popular topic. Conventional location recommendations usually collected user's past GPS path and used data mining techniques to find user's moving trajectory, and then give the corresponding location recommendations. Based on multiple users’ GPS trajectories [1], Zheng et al. aimed to mine interesting locations and classical travel sequences in a given geospatial region. Morzy [2] used the past trajectory of the object and combines it with movement rules discovered in the moving objects database for predicting the location. Furthermore, he also proposed a probabilistic model of object location prediction [3]. Monreale et al. [4] proposed a location predictor WhereNext, which uses the locations visited by users to build a decision tree, and finds users’ trajectory patterns, and then uses the trajectory patterns to predict the next location.","Location-based Social Networks (LSNs) have become extremely popular. Recently, people try to use the location records of LSNs to recommend location. Berjani and Strufe [5] proposed a recommendation scheme based on regularized matrix factorization (RMF). They collected locations and users, and mapped them to an n-dimensional space, and then calculate the inner-product between user and location to recommend location. This study is characterized by mapped users and locations to the same two-dimensional space. The difference between our paper and this study is that we also consider the time factor and the user's personal characteristics.","Ye et al. [6] developed a friend-based collaborative filtering (FCF) approach for location recommendation based on collaborative ratings of places made by social friends. Moreover, they proposed a variant of FCF technique, namely Geo-Measured FCF (GM-FCF), based on some heuristics derived from observed geospatial characteristics. First, they use the distance between a user and his friends to calculate similarity. Second, according to the score of location given by a friend and the friend’s similarity, they can calculate the recommend score between a user and location. Finally, they select top n locations to recommend. Using friendship to recommend locations is the main idea in this study.","Wei [7] used data mining techniques based on the location information of LSNs to find user’s trajectory patterns, and then utilized the trajectory patterns to recommend locations. The advantage of this study is to explore a few useful features of location.","The difference between our work and conventional location recommendation work is that we not only recommend activities as well as locations. Besides it, mining useful information like consecutive itinerary from check-in data is a new and important research direction."]},{"title":"3. Method","paragraphs":["3.1 Observation of Consecutive Itinerary"," Check-in Data As mentioned before, many mobile users usually tend to leave check-in records when arriving tourist attractions or interesting spots. Therefore, we collected a large number of different mobile users’ check-in data from Facebook, and then listed a sequence of check-ins for each user according to their arrival time. As a result, we often can find a number of interesting itineraries for the user based on his sequential check-ins. The observation of sequential check-ins inspired us to discover interesting itineraries from Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 290 the large collection of mobile users’ check-in data, and then utilize these interesting itineraries for recommendation of next location and activity for mobile users. In this work, we thus simply define any two sequential check-ins of each user as a consecutive itinerary in advance, and show an example of a consecutive itinerary in Figure 2. Figure 2. A consecutive itinerary of Check-in data Figure 3. Consecutive itineraries in a travel blog Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 291  Travel Blogs","To discover more interesting consecutive itineraries for recommendation of next location and activity for mobile users, we also explore a large number of travel blogs collected from Pixnet.net. An example is shown in Figure 3. A user shares her journey to “北投” in a blog post which describes four interesting tourist attractions. According to the observation, actually, we can also find consecutive itineraries from travel blogs.","Based on the preliminary observations of consecutive itineraries on check-in data and travel blogs, furthermore, we intend to understand how and which features will influence mobile users to decide their next itineraries. According to our further observations, besides location distance, time and user’s personal information, such as gender or age, also affect the user’s decision about his next itinerary. For example, when a user visits “安平老街” during the day, he likely go to “赤崁樓” next; but when a user visits “安平老街” at night, they likely intend to go to “花園夜市” next. In this study, we try to use five features in check-ins and travel blogs to recommend next location and activity to users. These five features include user's current location, current activity, arrival time, user gender, and user age. 3.2 Consecutive Itinerary Matching Model (CIMM)","In this study, we try to find user’s needs about next location and activity from user’s current check-in post. In fact, a check-in post only contains four kinds of information, including “Time”, “Location”, “User”, and “Message” . Basically, the message snippets include activity terms and context words associated with the check-in locations. Thus, we utilize a few effective POS tag patterns to extract correct activity terms. The pre-process of activity term extraction is neglected due to the limitation of paper size. Based on the five proposed features, we proposed Consecutive Itinerary Matching Model (CIMM). If a user posts a new check-in C, we try to use the CIMM with the discovered consecutive itineraries to predict the best user’s needs from the candidate sets of user’s next needs n about location Ln and activity An,, where , and therefore can be modeled as follows: (1) The given current check-in data C includes five information"]},{"title":"C = (L","paragraphs":["c"]},{"title":", A","paragraphs":["c"]},{"title":", T","paragraphs":["c"]},{"title":", UG","paragraphs":["c"]},{"title":", UA","paragraphs":["c"]},{"title":")","paragraphs":[", where"]},{"title":"L","paragraphs":["c is current location,"]},{"title":"A","paragraphs":["c is current activity,"]},{"title":"T","paragraphs":["c is arrival time,"]},{"title":"UG","paragraphs":["c is user gender, and"]},{"title":"UA","paragraphs":["c is user age. The CIMM utilizes the discovered consecutive itineraries to predict the best user’s needs. A consecutive itinerary is composed of two parts, where pi is a previous itinerary and ni is the next itinerary. pi contains five features , where is previous location, is previous activity, is arrival time, is user gender, is user age. ni contains two features , where is next location, and is next activity. We use previous itinerary to calculate the similarity between current check-in Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 292 data and consecutive itinerary , and the next itinerary can be considered as user’s need n . Therefore, the probability P(n|C) can be derived indirectly as follows: (2) where is the similarity between current check-in data and previous itinerary . is the probability of finding user’s location and activity needs if current check-in data and previous itinerary are given. To filter out a number of unsuitable candidates of consecutive itinerary , we set two thresholds of time difference and location distance, respectively. If the time difference or location distance between current check-in data and previous itinerary are over the thresholds, the previous itinerary i cannot be considered as a candidate. For example, if a user at “墾丁” (Kenting) give a check-in post, the previous itinerary pi given at “台北” (Taipei) should be useless to the reference of the user’s next need, and then the similarity between current check-in data C and previous itinerary is 0. We designed the itinerary similarity computation algorithm to calculate , which is shown in Figure 4. Itinerary Similarity Computation Algorithm Input: current check-in post and previous itinerary Output: the similarity between and 1、 If (time difference between and > 12 hours) then 2、 3、 End If 4、 Else 5、 If (location distance between and > 100 km) then 6、 Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 293 7、 End If 8、 Else 9、 10、 End Else 11、End Else 12、Return Figure 4: The illustration of itinerary similarity computation algorithm In fact, we observed that current check-in post and previous itinerary have the same features. Therefore, we put these five same features together into a set. Besides, for the activity feature, we particularly divide the feature into two subfeatures, activity edit-distance and activity nature. Thus, based on the feature set consisting of six features , the log-linear model can be properly applied to compute the probability . Thus, (3) where is the number of features, is a feature weight parameter, and is the feature function, which is mapped with the corresponding feature names shown in Table 1 and will be introduced in Section 3.3. Table 1. The corresponding names of the six feature functions fj Feature Function f1 f2 f3 f4 f5 Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 294 f6 3.3 Feature Functions 3.3.1 Time Difference","In fact, some locations are more suitable to visit at the specific period of time. For example, night markets and bars are more suitable to go at night, but museums and traditional markets are more suitable to go during the day. If the arrival time of current check-in post and previous itinerary is closer, then the next visiting locations and activities should be more similar. Thus, the first feature function we considered is the function of time difference and is as follows: (4) where is the time difference between and, is the time of"]},{"title":"previous itinerary","paragraphs":[", is the time of current check-in post , and is the maximum time difference between all previous itineraries and the current check-in post . 3.3.2 User Gender","Gender difference is always an interesting topic for the research fields of social science and psychology, and, of course, also affects the location choice of an itinerary for mobile users. 王維誠 [8] reported that the choice of tourist attractions has a little difference between different kind of genders. 林晏州 [9] also reported that gender is an important factor to tourist attractions. Therefore, we conclude that if users have the same gender, then they will have similar interest to visit the same locations. The feature function of gender difference is given as follows: (5) where is the user gender of"]},{"title":"previous itinerary","paragraphs":[", and is the user gender of current check-in post . 3.3.3 User Age","Age is an important factor for users to choose locations. In general, elders are more likely to visit natural landscape but young men may choose the amusement park. 王維誠 [28] pointed out that the choice of tourist attractions have great difference between different kinds of ages. Kotler [30] also reported that age is one of important influence factors to the choice Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 295 of tourist attractions. Therefore, we use user age as one of important features for recommendation of location and activity need The feature function of user age is defined as follows: (6) where is the age difference between and , is the user age of"]},{"title":"previous itinerary","paragraphs":[", is the user age of current check-in post , and is the maximum age difference between all previous itineraries and the current check-in data . 3.3.4 Location Distance","When people is planning travel itinerary, with the consideration of convenient transportation, they accustomed to arrange those nearby locations together. If the distance between two locations is closer, the probability of going to the same location next is higher. For example, if a user strolls a street in “墾丁” (Kenting), they will choose Kenting National Park as next location than Taipei 101. The feature function of location distance is described as follows: (7) where is the location distance between and , is the location of"]},{"title":"previous itinerary","paragraphs":[", is the location of current check-in post , and is the maximum location distance between all previous itineraries and current check-in post . 3.3.5 Activity Edit-distance","We think the current activity may affect the user’s choice of next activities. For example, people likely go to eat some foods or drinks after they go shopping. Therefore, we calculated the edit-distance between two sets of activities. For example, the edit-distance between “打籃 球” and “打棒球” is 1 and the edit-distance between“打籃球” and “看電影” is 3. The feature function of activity edit-distance is described as follows: (8) where is the average edit-distance between and , and Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 296 is the maximum average edit-distance of activities between all previous itineraries and the current check-in data . In general, users may engage in several activities at one location. For example, we can go shopping and eat some food at department stores. and are activity sets. The function of calculating the average edit-distance of a set of activities is given as follows: (9) where is the activity set of"]},{"title":"previous itinerary","paragraphs":[", is the activity set of current check-in post . We calculate the edit-distance between each activity of"]},{"title":"previous itinerary","paragraphs":["and activity of the current check-in post , and then we calculate the average value. 3.3.6 Activity Nature","The nature of activity can be divided into two types, i.e., dynamic or static. We think that a user’s choice of next activities will be similar after engaging in the same type of activity. For example, a user may be looking for a place to rest after he played basketball or swam. Playing basketball and swimming both belong to the type of dynamic activity. The feature function of activity nature is described as follows: (10) where x is the activity’s nature of the activity X. We identify the nature of an activity by using the activity nature lexicon which is compiled by ourselves."]},{"title":"4. Experimental Evaluation","paragraphs":["4.1 Dataset","We crawled 95220 check-ins from Facebook and 23703 travel blog posts from Pixnet.net. We also crawled user’s personal information and used Facebook’s location fans page to collect location’s information, and then used the method mentioned in Section 3.2 to extract consecutive itineraries. In order to avoid the case of incorrect activities and locations affecting the system performance, first, we used the Facebook’s location fans page to exclude most of the incorrect locations. Second, we count the number of each activity, and we identify those activities which the number is less than 3 as unreliable activity. Then we excluded unreliable activities from all consecutive itineraries. Finally, in the check-in data, we collected 1413 users, 6391 locations and extracted 6469 consecutive itineraries. In the travel blogs, we collected 445 users, 4132 locations, and extracted 5237 consecutive itineraries. A few statistics of the two data sets are shown in Table 2. Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 297 Table 2.Statistics of the two collected data sets Data Resource Facebook Pixnet Data Type Check-in data Blog travel article Total Number 95200 23703 User Number 1413 445 Location Number 6391 4132","Consecutive Itinerary Number 6469 5237 4.2 Parameter Estimation","To understand the importance of the proposed features, we estimated the weights for each feature function. And then our CIMM used these weights to rank each recommended location and activity pair for each testing check-in post.","We use consecutive itineraries which have correct answers as user’s current check-in data. A consecutive itinerary with a correct answer is identified if the other consecutive itineraries went to the same location next and attended the same activity with this consecutive itinerary. It can prevent choosing the consecutive itineraries which have incorrect location or activity. Totally, 594 consecutive itineraries with correct answers are selected from the collected check-in data, and then we took 70% of them as training data and the rest 30% as testing data. We labeled a correct answer for each itinerary if the next location and activity are the same. Then we selected all consecutive itineraries with correct answers and the same number of consecutive itineraries with incorrect answers randomly. Finally, 2708 labeled consecutive itineraries are used to train the weights for each feature function, which are estimated by using the logarithm of likelihood function, called log-likelihood [11]. The concept of log-likelihood is the same as maximum-likelihood estimation (MLE). The trained weights are used in this study.","We can see that time difference and location distance are more important to determine next location and activity pair. Furthermore, weights of activity edit-distance and activity nature are only 0.063 and 0.055, which means these two features have less influence. 4.3 Evaluation of Consecutive Itinerary Matching Model","In this experiment, we use top-n inclusion rate to evaluate the performance of our model and compare with different feature function combinations as baselines.  Remove Activity Edit-distance and Activity Nature (Remove AE & AN)","According to the analysis of feature weights above, user’s current activity to next location and activity has less effect, however, we still want to know how much performance is reduced or increased while removing activity-related feature functions. Therefore, the first baseline is to remove the features activity edit-distance and activity nature. Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 298  Remove User Gender and User Age (Remove UG & UA)","We also want to know whether user's personal information can have more effects on the performance of our CIMM or not. Therefore, the second baseline is to remove the features user gender and user age.  Remove Time Difference and Location Distance (Remove TD & LD)","Finally, we want to know what performance influence when removing the most important feature functions, time difference and location distance. This case is considered as the third baseline.","Based on the different kinds of feature combination, we have to recalculate feature function weights for each baseline. The results of weight recalculation is shown in Table 3, Table 3. Weights of feature functions for different kinds of feature combinations","Feature Combination","CIMM 0.220 0.076 0.134 0.453 0.063 0.055 Remove_AE&AN 0.245 0.087 0.150 0.518 0 0 Remove_UG&UA 0.275 0 0 0.581 0.076 0.068 Remove_TD&LD 0 0.238 0.412 0 0.186 0.164 Figure 5. Top-n Inclusion Rate of different feature combinations","The experimental results of CIMM and other methods with different kinds of feature combination are shown in Figure 5. We can see that the top-n inclusion rate of CIMM is better than those of all other baselines. Obviously, the top-n inclusion rate will decline if we remove any of feature functions. Removing activity edit-distance, activity nature, user gender 0 0.05 0.1 0.15 0.2 0.25 0.3 0.35 0.4 0.45 0.5 Top-1 Top-3 Top-5 Top-10 CIMM Remove_AE&AN Remove_UG&UA Remove_TD&LD Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 299 or user age, caused a little reduction of the top-n inclusion rate, but the top-n inclusion rate will decline significantly when removing the two features time difference and location distance. The results imply that these two features are very important for the performance of CIMM, and each feature has effect to our CIMM. Table 4. The incorrect example of CIMM","Time User Gender User Age Current Location Current Activity","Next Location","Next Activity","Test 16:21 Male 27 安平老街 逛街,吃 台南花園 夜市 吃","Top-1 13:09 Male 29 安平老街 逛,買 夕遊 出張所 看夕陽, 買鹽","Top-2 16:45 Male 29 赤嵌樓 走走 Little House 買飾品","Top-3 16:32 Male 27 走馬瀨農場 看風景 台南花園 夜市 吃晚餐","To understand the problem of location and activity recommendation by using CIMM, we made error analysis and show an example of incorrect answer in Table 4. In the example, the next correct location and activity pair of the testing check-in post at the location “安平老街” is (台南花園夜市, 吃), and the top-3 next location and activity pair recommended by CIMM are as follows: 1.(夕遊出張所, 看夕陽,買鹽) 2.( Little House, 買飾品) 3.(台南花園夜市, 吃晚餐) (correct answer)","According to our analysis, the correct answer (台南花園夜市, 吃晚餐) is ranked at third place for two reasons. First, the current location of the consecutive itinerary with correct answer is “走馬瀨農場” and the current locations of the first and the second ranks are “安平 老街” and “赤嵌樓”. The third ranked location“走馬瀨農場” is farther from “安平老街”than “安平老街”(the first rank) or “赤嵌樓”(the second rank), and the location distance is the most important feature. Second, the current activity is also different between the third ranked activity“看風景”and the activity of the test check-in “逛街,吃”. Therefore, these reasons make the correct answer “吃晚餐” as the third rank."]},{"title":"5. Conclusions","paragraphs":["In this paper, we proposed Consecutive Itinerary Matching Model (CIMM) to effectively recommend mobile users next locations and activities while they check-in to a place. This model uses six feature functions, including time difference, user gender, user age, location distance, activity edit-distance, and activity nature to find possible location and activity pair for a use’s current check-in post based on consecutive itineraries extracted from check-in data and travel blogs,. Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 300","In our experiment, the top-n inclusion rate of CIMM is better than other different feature combinations. This result illustrate that each feature has effect to the performance of our CIMM. In this preliminary study, although our approach achieved only about 30% top-1 inclusion rate, however, to our knowledge, this work is novel for consecutive itinerary discovery from check-in data."]},{"title":"References","paragraphs":["[1] Y. Zheng, L. Z. Zhang, X. Xie and W. Y. Ma, “Mining Interesting Locations and Travel Sequences from GPS Trajectories,” WWW’09, Madrid, Spain, Apr 2009.","[2] M. Morzy, “Prediction of Moving Object Location Based on Frequent Trajectories,” ISCIS’06, Istanbul, Turkey, Nov 2006.","[3] M. Morzy, “Mining Frequent Trajectories of Moving Objects for Location Prediction,” MLDM’07, Leipzig, Germany, Jul 2007.","[4] A. Monreale, F. Pinelli, R. Trasarti and F. Giannotti, “WhereNext: a Location Predictor on Trajectory Pattern Mining,” KDD’09, Paris, France, Jul 2009.","[5] B. Berjani and T. Strufe, “A Recommendation System for Spots in Location-Based Online Social Networks,” SNS’11, Salzburg, Austria, Apr 2011. [6] M. Ye, P. F. Yin and W. C. Lee, “Location Recommendation for Location-based Social Networks,” ACM GIS’10, San Jose, CA, USA, Nov 2010. [7] L. Y. Wei, “Trajectory Pattern Mining in Social Media,” Master thesis, Univ. of Chiao Tung, Taiwan, 2012. [8] 王維誠, “風景區觀光吸引力、服務品質與滿意度之研究─以阿里山國家風景區為 例,” Master thesis, Univ. of Nan Hua, Taiwan. 2009. [9] 林晏州, “遊憩者選擇遊憩區行為之研究,” 都市與計畫, no. 10, pp.33-49, 1984. [10] P. Kotler, “Marketing management: Analysis, planning, implementation, and control,” (9th ed.), NJ.: Prentice-Hall,1997. [11] C. Elkan, “Log-linear models and conditional random fields,” CIKM, 2008. Proceedings of the Twenty-Fifth Conference on Computational Linguistics and Speech Processing (ROCLING 2013) 301"]}]}